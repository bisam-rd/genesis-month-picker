<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>genesis-month-picker test</title>

    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../genesis-month-picker.html">
    
    <script src="../bower_components/moment/min/moment.min.js"></script>
  </head>
  <body>

    <test-fixture id="BasicTestFixture">
      <template>
        <genesis-month-picker value="2018-12-20"></genesis-month-picker>
      </template>
    </test-fixture>

    <test-fixture id="LocaleTestFixture">
        <template>
          <genesis-month-picker value="2018-12-20" locale="en-US"></genesis-month-picker>
        </template>
      </test-fixture>

    <test-fixture id="ChangedPropertyTestFixture">
      <template>
        <genesis-month-picker prop1="new-prop1"></genesis-month-picker>
      </template>
    </test-fixture>

    <script>
      suite('genesis-month-picker', () => {

        test('The date of the Genesis Month Picker should be positionned to end of month', () => {
          const element = fixture('BasicTestFixture');
          assert.equal(element.value, '2018-12-31');
        });

        test('The default locale of the Genesis Month Picker should be french', () => {
          const element = fixture('BasicTestFixture');
          assert.equal(element.value, '2018-12-31');

          const elementShadowRoot = element.shadowRoot;
          const dateField = elementShadowRoot.querySelector('#dateField');
          assert.equal(dateField.value, '31/12/2018');
        });

        test('The local prop should override the default locale', () => {
          const element = fixture('LocaleTestFixture');
          assert.equal(element.value, '2018-12-31');

          const elementShadowRoot = element.shadowRoot;
          const dateField = elementShadowRoot.querySelector('#dateField');
          assert.equal(dateField.value, '12/31/2018');
        });

        test('Changing the date field should be reflected on the date value ', () => {
          const element = fixture('BasicTestFixture');
          assert.equal(element.value, '2018-12-31');

          const elementShadowRoot = element.shadowRoot;
          const dateField = elementShadowRoot.querySelector('#dateField');
          dateField.focus();
          dateField.value = '04/01/2019';
          dateField.blur();
          assert.equal(dateField.value, '31/01/2019');
          assert.equal(element.value, '2019-01-31');
        });

        test('Setting no value in the date field should set the backing value to null', () => {
          const element = fixture('BasicTestFixture');
          assert.equal(element.value, '2018-12-31');
          const dateNow=new Date();
          const dateEndOfMonth=new Date(dateNow.getFullYear(), dateNow.getMonth()+1,0);

          const elementShadowRoot = element.shadowRoot;
          const dateField = elementShadowRoot.querySelector('#dateField');
          dateField.focus();
          dateField.value = '';
          dateField.blur();
          assert.equal(dateField.value, '');
          assert.equal(element.value, null);
        });

        

        test('Setting the date value not to end of month should set the date field to end of month and readjust the value to end of month', () => {
          const element = fixture('BasicTestFixture');
          assert.equal(element.value, '2018-12-31');
          element.value = "2018-03-03";
          
          const elementShadowRoot = element.shadowRoot;
          const dateField = elementShadowRoot.querySelector('#dateField');

          assert.equal(dateField.value, '31/03/2018');
          assert.equal(element.value, '2018-03-31');
        });

      
      });
    </script>

  </body>
</html>
